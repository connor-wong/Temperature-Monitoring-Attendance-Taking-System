{"ast":null,"code":"import _regeneratorRuntime from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import axios from\"axios\";import{Row,Col,Container}from\"react-bootstrap\";import NavBar from\"./NavBar\";import LatestAttendance from\"./LatestAttendance/LatestAttendance\";import StudentMatters from\"./StudentMatters/StudentMatters\";import Classes from\"./Classes/Classes\";import{displayNotification}from\"../../serviceWorkerRegistration\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var requestPermission=function requestPermission(){Notification.requestPermission(function(status){//console.log(\"Notification permission status\", status);\n});};var Dashboard=function Dashboard(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),classes=_useState2[0],setClasses=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),attendance=_useState4[0],setAttendance=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),temperatureMatter=_useState6[0],setTemperatureMatter=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),lowAttendanceMatter=_useState8[0],setlowAttendanceMatter=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),isLoading=_useState10[0],setIsLoading=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),updateData=_useState12[0],setUpdateData=_useState12[1];requestPermission();useEffect(function(){if(updateData){getData();displayNotification();}},[updateData]);var getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var classes,classArray,studentArray,dataArray,dateArray,attendance,temperatureMatter,lowAttendanceMatter,absentArray,_loop,_i,_classArray;return _regeneratorRuntime.wrap(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:classes=[];classArray=[];studentArray=[];dataArray=[];dateArray=[];attendance=[];temperatureMatter=[];lowAttendanceMatter=[];absentArray=[];_context2.next=11;return fetch(\"/drive/api\");case 11:_context2.next=13;return fetch(\"/sheet/api\").then(function(res){return res.json();}).then(function(res){classes=res.sheets;res.sheets.forEach(function(result){classArray.push(result.properties.title);});});case 13:_loop=/*#__PURE__*/_regeneratorRuntime.mark(function _loop(){var classTitle,studentList,latestAttendanceData,date,totalStudents,presentCount,absentChecker;return _regeneratorRuntime.wrap(function _loop$(_context){while(1){switch(_context.prev=_context.next){case 0:classTitle=_classArray[_i];studentList=[];_context.next=4;return axios.post(\"/sheet/class\",classTitle);case 4:_context.next=6;return fetch(\"/sheet/student\")// Get Student List\n.// Get Student List\nthen(function(res){return res.json();}).then(function(res){studentArray=res;});case 6:_context.next=8;return fetch(\"/aws/api\")// Get Student Attendance\n.// Get Student Attendance\nthen(function(res){return res.json();}).then(function(res){dataArray=res;});case 8:// Sort to latest date\ndataArray.sort(function(a,b){return new Date(b.Date)-new Date(a.Date);});// Data formation\nlatestAttendanceData=dataArray.filter(function(res){return res.Date.includes(dataArray[0].Date.split(\" \")[0]);});if(dataArray.length<1||dataArray===undefined){// do nothing\n}else{date=dataArray[0].Date.split(\" \")[0];totalStudents=studentArray.length;presentCount=0;studentArray.forEach(function(res){latestAttendanceData.forEach(function(student){if(res[0].includes(student.Name)){presentCount=presentCount+1;}});// Convert array to object\nstudentList.push({Name:res[0],ID:res[1],Class:classTitle});});// Class, Date, Present, Total Students\nattendance.push({Class:classTitle,Date:date,Present:presentCount,Total_Students:totalStudents});// Student Matters (High Temperature)\nlatestAttendanceData.forEach(function(student){if(student.Temperature>=37.5){temperatureMatter.push(student);}});// Student Matters (Low Attendance)\ndataArray.forEach(function(data){dateArray.push(data.Date.split(\" \")[0]);});dateArray=_toConsumableArray(new Set(dateArray));// Remove Duplicates\ndateArray.forEach(function(date){var attendance=[];var absentList=[];attendance=dataArray.filter(function(res){return res.Date.includes(date);});if(attendance.length!==0){absentList=studentList.filter(function(_ref2){var id1=_ref2.Name;return!attendance.some(function(_ref3){var id2=_ref3.Name;return id2===id1;});});absentArray=[].concat(_toConsumableArray(absentArray),_toConsumableArray(absentList));}});absentChecker=[];absentChecker=absentArray.filter(function(res){return res.Class.includes(classTitle);});lowAttendanceMatter=[].concat(_toConsumableArray(lowAttendanceMatter),_toConsumableArray(absentChecker.reduce(function(acc,el,i,arr){if(arr.indexOf(el)!==i&&acc.indexOf(el)<0)acc.push(el);return acc;},[])));}case 11:case\"end\":return _context.stop();}}},_loop);});_i=0,_classArray=classArray;case 15:if(!(_i<_classArray.length)){_context2.next=20;break;}return _context2.delegateYield(_loop(),\"t0\",17);case 17:_i++;_context2.next=15;break;case 20:setClasses(classes);// Class Component\nsetAttendance(attendance);// LatestAttendance Component\nsetTemperatureMatter(temperatureMatter);// Student Matter Component\nsetlowAttendanceMatter(lowAttendanceMatter);// Student Matter Component\nsetIsLoading(false);setUpdateData(false);case 26:case\"end\":return _context2.stop();}}},_callee);}));return function getData(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsxs(Container,{className:\"text-center dashboard\",fluid:true,children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:\"calc(22px + 2vw)\",fontWeight:\"bold\",color:\"#535353\",textAlign:\"left\"},children:\"Your Dashboard\"})})}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{xl:6,lg:12,md:12,sm:12,xs:12,children:[/*#__PURE__*/_jsx(Row,{style:{marginBottom:\"10px\"},children:/*#__PURE__*/_jsx(Col,{xl:12,lg:12,md:12,sm:12,xs:12,children:/*#__PURE__*/_jsx(LatestAttendance,{attendance:attendance,isLoading:isLoading,setUpdateData:setUpdateData})})}),/*#__PURE__*/_jsx(Row,{style:{marginBottom:\"10px\"},children:/*#__PURE__*/_jsx(Col,{xl:12,lg:12,md:12,sm:12,xs:12,children:/*#__PURE__*/_jsx(StudentMatters,{temperatureMatter:temperatureMatter,lowAttendanceMatter:lowAttendanceMatter,isLoading:isLoading})})})]}),/*#__PURE__*/_jsx(Col,{xl:6,lg:12,md:12,sm:12,xs:12,style:{marginBottom:\"10px\"},children:/*#__PURE__*/_jsx(Classes,{classes:classes,isLoading:isLoading,setUpdateData:setUpdateData})})]})]})]});};export default Dashboard;","map":{"version":3,"sources":["C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/src/components/Dashboard/Dashboard.js"],"names":["React","useEffect","useState","axios","Row","Col","Container","NavBar","LatestAttendance","StudentMatters","Classes","displayNotification","requestPermission","Notification","status","Dashboard","classes","setClasses","attendance","setAttendance","temperatureMatter","setTemperatureMatter","lowAttendanceMatter","setlowAttendanceMatter","isLoading","setIsLoading","updateData","setUpdateData","getData","classArray","studentArray","dataArray","dateArray","absentArray","fetch","then","res","json","sheets","forEach","result","push","properties","title","classTitle","studentList","post","sort","a","b","Date","latestAttendanceData","filter","includes","split","length","undefined","date","totalStudents","presentCount","student","Name","ID","Class","Present","Total_Students","Temperature","data","Set","absentList","id1","some","id2","absentChecker","reduce","acc","el","i","arr","indexOf","fontSize","fontWeight","color","textAlign","marginBottom"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Row, Col, Container } from \"react-bootstrap\";\r\n\r\nimport NavBar from \"./NavBar\";\r\nimport LatestAttendance from \"./LatestAttendance/LatestAttendance\";\r\nimport StudentMatters from \"./StudentMatters/StudentMatters\";\r\nimport Classes from \"./Classes/Classes\";\r\n\r\nimport { displayNotification } from \"../../serviceWorkerRegistration\";\r\n\r\nconst requestPermission = () => {\r\n  Notification.requestPermission((status) => {\r\n    //console.log(\"Notification permission status\", status);\r\n  });\r\n};\r\n\r\nconst Dashboard = () => {\r\n  const [classes, setClasses] = useState([]);\r\n  const [attendance, setAttendance] = useState([]);\r\n  const [temperatureMatter, setTemperatureMatter] = useState([]);\r\n  const [lowAttendanceMatter, setlowAttendanceMatter] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [updateData, setUpdateData] = useState(true);\r\n\r\n  requestPermission();\r\n\r\n  useEffect(() => {\r\n    if (updateData) {\r\n      getData();\r\n      displayNotification();\r\n    }\r\n  }, [updateData]);\r\n\r\n  const getData = async () => {\r\n    let classes = [];\r\n    let classArray = [];\r\n    let studentArray = [];\r\n    let dataArray = [];\r\n    let dateArray = [];\r\n    let attendance = [];\r\n    let temperatureMatter = [];\r\n    let lowAttendanceMatter = [];\r\n    let absentArray = [];\r\n\r\n    await fetch(\"/drive/api\");\r\n\r\n    await fetch(\"/sheet/api\")\r\n      .then((res) => res.json())\r\n      .then((res) => {\r\n        classes = res.sheets;\r\n        res.sheets.forEach((result) => {\r\n          classArray.push(result.properties.title);\r\n        });\r\n      });\r\n\r\n    for (const classTitle of classArray) {\r\n      let studentList = [];\r\n      await axios.post(\"/sheet/class\", classTitle);\r\n\r\n      await fetch(\"/sheet/student\") // Get Student List\r\n        .then((res) => res.json())\r\n        .then((res) => {\r\n          studentArray = res;\r\n        });\r\n\r\n      await fetch(\"/aws/api\") // Get Student Attendance\r\n        .then((res) => res.json())\r\n        .then((res) => {\r\n          dataArray = res;\r\n        });\r\n\r\n      // Sort to latest date\r\n      dataArray.sort((a, b) => {\r\n        return new Date(b.Date) - new Date(a.Date);\r\n      });\r\n\r\n      // Data formation\r\n      const latestAttendanceData = dataArray.filter((res) =>\r\n        res.Date.includes(dataArray[0].Date.split(\" \")[0])\r\n      );\r\n\r\n      if (dataArray.length < 1 || dataArray === undefined) {\r\n        // do nothing\r\n      } else {\r\n        const date = dataArray[0].Date.split(\" \")[0];\r\n        const totalStudents = studentArray.length;\r\n        let presentCount = 0;\r\n\r\n        studentArray.forEach((res) => {\r\n          latestAttendanceData.forEach((student) => {\r\n            if (res[0].includes(student.Name)) {\r\n              presentCount = presentCount + 1;\r\n            }\r\n          });\r\n          // Convert array to object\r\n          studentList.push({\r\n            Name: res[0],\r\n            ID: res[1],\r\n            Class: classTitle,\r\n          });\r\n        });\r\n\r\n        // Class, Date, Present, Total Students\r\n        attendance.push({\r\n          Class: classTitle,\r\n          Date: date,\r\n          Present: presentCount,\r\n          Total_Students: totalStudents,\r\n        });\r\n\r\n        // Student Matters (High Temperature)\r\n        latestAttendanceData.forEach((student) => {\r\n          if (student.Temperature >= 37.5) {\r\n            temperatureMatter.push(student);\r\n          }\r\n        });\r\n\r\n        // Student Matters (Low Attendance)\r\n        dataArray.forEach((data) => {\r\n          dateArray.push(data.Date.split(\" \")[0]);\r\n        });\r\n\r\n        dateArray = [...new Set(dateArray)]; // Remove Duplicates\r\n\r\n        dateArray.forEach((date) => {\r\n          let attendance = [];\r\n          let absentList = [];\r\n\r\n          attendance = dataArray.filter((res) => res.Date.includes(date));\r\n\r\n          if (attendance.length !== 0) {\r\n            absentList = studentList.filter(\r\n              ({ Name: id1 }) =>\r\n                !attendance.some(({ Name: id2 }) => id2 === id1)\r\n            );\r\n            absentArray = [...absentArray, ...absentList];\r\n          }\r\n        });\r\n\r\n        let absentChecker = [];\r\n        absentChecker = absentArray.filter((res) =>\r\n          res.Class.includes(classTitle)\r\n        );\r\n\r\n        lowAttendanceMatter = [\r\n          ...lowAttendanceMatter,\r\n          ...absentChecker.reduce(function (acc, el, i, arr) {\r\n            if (arr.indexOf(el) !== i && acc.indexOf(el) < 0) acc.push(el);\r\n            return acc;\r\n          }, []),\r\n        ];\r\n      }\r\n    }\r\n\r\n    setClasses(classes); // Class Component\r\n    setAttendance(attendance); // LatestAttendance Component\r\n    setTemperatureMatter(temperatureMatter); // Student Matter Component\r\n    setlowAttendanceMatter(lowAttendanceMatter); // Student Matter Component\r\n    setIsLoading(false);\r\n    setUpdateData(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <NavBar />\r\n      <Container className=\"text-center dashboard\" fluid>\r\n        <Row>\r\n          <Col>\r\n            <h3\r\n              style={{\r\n                fontSize: \"calc(22px + 2vw)\",\r\n                fontWeight: \"bold\",\r\n                color: \"#535353\",\r\n                textAlign: \"left\",\r\n              }}\r\n            >\r\n              Your Dashboard\r\n            </h3>\r\n          </Col>\r\n        </Row>\r\n\r\n        <Row>\r\n          <Col xl={6} lg={12} md={12} sm={12} xs={12}>\r\n            <Row style={{ marginBottom: \"10px\" }}>\r\n              <Col xl={12} lg={12} md={12} sm={12} xs={12}>\r\n                <LatestAttendance\r\n                  attendance={attendance}\r\n                  isLoading={isLoading}\r\n                  setUpdateData={setUpdateData}\r\n                />\r\n              </Col>\r\n            </Row>\r\n\r\n            <Row style={{ marginBottom: \"10px\" }}>\r\n              <Col xl={12} lg={12} md={12} sm={12} xs={12}>\r\n                <StudentMatters\r\n                  temperatureMatter={temperatureMatter}\r\n                  lowAttendanceMatter={lowAttendanceMatter}\r\n                  isLoading={isLoading}\r\n                />\r\n              </Col>\r\n            </Row>\r\n          </Col>\r\n\r\n          <Col\r\n            xl={6}\r\n            lg={12}\r\n            md={12}\r\n            sm={12}\r\n            xs={12}\r\n            style={{ marginBottom: \"10px\" }}\r\n          >\r\n            <Classes\r\n              classes={classes}\r\n              isLoading={isLoading}\r\n              setUpdateData={setUpdateData}\r\n            />\r\n          </Col>\r\n        </Row>\r\n      </Container>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n"]},"metadata":{},"sourceType":"module"}