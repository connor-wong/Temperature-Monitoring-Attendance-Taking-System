{"ast":null,"code":"import _regeneratorRuntime from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _createForOfIteratorHelper from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useState}from\"react\";import{CognitoUser,AuthenticationDetails}from\"amazon-cognito-identity-js\";import Pool from\"../../UserPool\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";var AccountContext=/*#__PURE__*/createContext();var Account=function Account(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isFirstLogin=_useState2[0],setIsFirstLogin=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),login=_useState4[0],setLogin=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),userAttr=_useState8[0],setUserAttr=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),userEmail=_useState10[0],setUserEmail=_useState10[1];var getSession=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return new Promise(function(resolve,reject){var user=Pool.getCurrentUser();if(user){user.getSession(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(err,session){var attributes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!err){_context.next=4;break;}reject();_context.next=8;break;case 4:_context.next=6;return new Promise(function(resolve,reject){user.getUserAttributes(function(err,attributes){if(err){reject(err);}else{var results={};var _iterator=_createForOfIteratorHelper(attributes),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var attribute=_step.value;var Name=attribute.Name,Value=attribute.Value;results[Name]=Value;}}catch(err){_iterator.e(err);}finally{_iterator.f();}setUserEmail(results.email);axios.post(\"/drive/email\",results.email);resolve(results);}});});case 6:attributes=_context.sent;resolve(_objectSpread(_objectSpread({user:user},session),attributes));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());}else{reject();}});case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function getSession(){return _ref.apply(this,arguments);};}();var authenticate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(Username,Password){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return new Promise(function(resolve,reject){var user=new CognitoUser({Username:Username,Pool:Pool});var authDetails=new AuthenticationDetails({Username:Username,Password:Password});user.authenticateUser(authDetails,{onSuccess:function onSuccess(data){console.log(\"onSuccess:\",data);setLogin(true);resolve(data);},onFailure:function onFailure(err){console.error(\"onFailure:\",err);setLogin(false);reject(err);},newPasswordRequired:function newPasswordRequired(data){console.log(\"newPasswordRequired:\",data);setIsFirstLogin(true);setUser(user);setUserAttr(data);resolve(data);}});});case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function authenticate(_x3,_x4){return _ref3.apply(this,arguments);};}();var logout=function logout(){var user=Pool.getCurrentUser();if(user){user.signOut();window.location.reload(false);}};return/*#__PURE__*/_jsx(AccountContext.Provider,{value:{authenticate:authenticate,getSession:getSession,logout:logout,login:login,isFirstLogin:isFirstLogin,user:user,userAttr:userAttr,userEmail:userEmail},children:props.children});};export{Account,AccountContext};","map":{"version":3,"sources":["C:/School Stuff/Modules/2021 Sem One/Final Year Project/Temperature Monitoring And Attendance Taking System/Web Interface Prototype/raspitar/client/src/components/Authentication/Account.js"],"names":["React","createContext","useState","CognitoUser","AuthenticationDetails","Pool","axios","AccountContext","Account","props","isFirstLogin","setIsFirstLogin","login","setLogin","user","setUser","userAttr","setUserAttr","userEmail","setUserEmail","getSession","Promise","resolve","reject","getCurrentUser","err","session","getUserAttributes","attributes","results","attribute","Name","Value","email","post","authenticate","Username","Password","authDetails","authenticateUser","onSuccess","data","console","log","onFailure","error","newPasswordRequired","logout","signOut","window","location","reload","children"],"mappings":"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","sourcesContent":["import React, { createContext, useState } from \"react\";\r\nimport { CognitoUser, AuthenticationDetails } from \"amazon-cognito-identity-js\";\r\nimport Pool from \"../../UserPool\";\r\nimport axios from \"axios\";\r\n\r\nconst AccountContext = createContext();\r\n\r\nconst Account = (props) => {\r\n  const [isFirstLogin, setIsFirstLogin] = useState(false);\r\n  const [login, setLogin] = useState(false);\r\n  const [user, setUser] = useState(\"\");\r\n  const [userAttr, setUserAttr] = useState(\"\");\r\n  const [userEmail, setUserEmail] = useState(\"\");\r\n\r\n  const getSession = async () =>\r\n    await new Promise((resolve, reject) => {\r\n      const user = Pool.getCurrentUser();\r\n      if (user) {\r\n        user.getSession(async (err, session) => {\r\n          if (err) {\r\n            reject();\r\n          } else {\r\n            const attributes = await new Promise((resolve, reject) => {\r\n              user.getUserAttributes((err, attributes) => {\r\n                if (err) {\r\n                  reject(err);\r\n                } else {\r\n                  const results = {};\r\n\r\n                  for (let attribute of attributes) {\r\n                    const { Name, Value } = attribute;\r\n                    results[Name] = Value;\r\n                  }\r\n                  setUserEmail(results.email);\r\n                  axios.post(\"/drive/email\", results.email);\r\n                  resolve(results);\r\n                }\r\n              });\r\n            });\r\n\r\n            resolve({\r\n              user,\r\n              ...session,\r\n              ...attributes,\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        reject();\r\n      }\r\n    });\r\n\r\n  const authenticate = async (Username, Password) =>\r\n    await new Promise((resolve, reject) => {\r\n      const user = new CognitoUser({ Username, Pool });\r\n      const authDetails = new AuthenticationDetails({ Username, Password });\r\n\r\n      user.authenticateUser(authDetails, {\r\n        onSuccess: (data) => {\r\n          console.log(\"onSuccess:\", data);\r\n          setLogin(true);\r\n          resolve(data);\r\n        },\r\n\r\n        onFailure: (err) => {\r\n          console.error(\"onFailure:\", err);\r\n          setLogin(false);\r\n          reject(err);\r\n        },\r\n\r\n        newPasswordRequired: (data) => {\r\n          console.log(\"newPasswordRequired:\", data);\r\n          setIsFirstLogin(true);\r\n          setUser(user);\r\n          setUserAttr(data);\r\n\r\n          resolve(data);\r\n        },\r\n      });\r\n    });\r\n\r\n  const logout = () => {\r\n    const user = Pool.getCurrentUser();\r\n    if (user) {\r\n      user.signOut();\r\n      window.location.reload(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AccountContext.Provider\r\n      value={{\r\n        authenticate,\r\n        getSession,\r\n        logout,\r\n        login,\r\n        isFirstLogin,\r\n        user,\r\n        userAttr,\r\n        userEmail,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </AccountContext.Provider>\r\n  );\r\n};\r\n\r\nexport { Account, AccountContext };\r\n"]},"metadata":{},"sourceType":"module"}